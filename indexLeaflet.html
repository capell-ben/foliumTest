<!DOCTYPE html>
<html>
<head>
    <title>Leaflet Map Example </title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <!-- STEP 1: Include Leaflet CSS & JS-->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="https://unpkg.com/@turf/turf@%5E7/turf.min.js"></script>
</head>
<body>
    <!-- STEP 2: Add HTML map container -->
    <div id="map" style = "height: 600px;"></div>
    <script>
        // STEP3: Set up Map
        var map = L.map('map'); //[52.52, 13.405], 13

        // STEP 4: Add Basemap
        // https://leafletjs.com/plugins.html#basemap-providers
        L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
         }).addTo(map);


        var geojsonFeature = {
            "type": "Feature",
            "properties": {
                "name": "Mouse Click",
                "amenity": "Previous",
                "popupContent": "This is where you wanted the geoJSON feature!"
            },
            "geometry": {
                "type": "Point",
                "coordinates": [-82.601797, 34.829265] //uses lng, lat
            }
        };


        // Add geojsonFeature object to map as a layer 
        var geojsonMarkerOptions = {
            radius: 16,
            fillColor: "#ff7800",
            color: "#000",
            weight: 1,
            opacity: 0.5,
            fillOpacity: 0.05
        };
        L.geoJSON(geojsonFeature, {
            pointToLayer: function (feature, latlng) {
                return L.circleMarker(latlng, geojsonMarkerOptions);
            }
        }).bindPopup(geojsonFeature.properties.popupContent).addTo(map);

        // Add geojsonFeature to object to a previously defined layer
        var myLayer = L.geoJSON().addTo(map);
        //myLayer.addData(geojsonFeature);

        // Add Custom Popup object & display lat lng of click & link the clicks with lines
        const popup = L.popup();
        let lastLngLat = L.latLng(34.829265, -82.601797); //uses lat, lng
        function onMapClick(e) {
            L.marker(e.latlng).addTo(map)
                .bindPopup("This is a previous click location: "+e.latlng.toString()).openPopup();
            popup
                .setLatLng(e.latlng)
                .setContent(`You clicked the map at ${e.latlng.toString()}`)
                .openOn(map);  
            const geojsonLine = {
                "type": "Feature",
                    "properties": {
                        "name": "Click Connector",
                        "drawDirection": "Previous to Current",
                        "popupContent": "This is to connect the clicks!"
                    },
                    "geometry": {
                        "type": "LineString",
                        "coordinates": [[lastLngLat.lng, lastLngLat.lat], [e.latlng.lng, e.latlng.lat]]
                    }
            };
        
            L.geoJSON(geojsonLine).bindPopup(geojsonLine.properties.popupContent).addTo(map);

            lastLngLat = e.latlng             
	    }

	    map.on('click', onMapClick);
        


        // STEP 5: Add Layer
        //fetch('x.geojson')
        //    .then(repsonse => response.json())
        //    .then(data => {
        //        L.geojson(data).addTo(map);
        //        });

    </script>
</body>
</html>